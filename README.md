# n8n + Nginx Reverse Proxy + Let's Encrypt

Production-ready n8n with automated HTTPS on any VPS.

## Quick Start

### 1. Install Git & Docker

```bash
# Install Git
sudo apt-get install -y git

# Install Docker
sudo apt-get update && sudo apt-get upgrade -y
curl -fsSL https://get.docker.com | sudo sh
sudo usermod -aG docker $USER && newgrp docker
```

### 2. Clone Repository

```bash
git clone git@github.com:arisonadim/n8n.git
cd n8n
```

(Or HTTPS: `git clone https://github.com/arisonadim/n8n.git`)

### 3. Configure

```bash
cp .env.example .env
nano .env  # Set VIRTUAL_HOST, LETSENCRYPT_EMAIL, N8N_BASIC_AUTH_PASSWORD
```

### 4. Start

```bash
make init   # generates encryption key
make up     # start all services
make status
```

Access: `https://n8n.example.com`

## Configuration

Edit `.env`:
- `VIRTUAL_HOST=n8n.example.com`
- `LETSENCRYPT_EMAIL=admin@n8n.example.com`
- `N8N_BASIC_AUTH_PASSWORD=strong_password`
- `N8N_ENCRYPTION_KEY=` (auto-generated by `make init`)

## Commands

```bash
make init              # Initialize & generate encryption key
make up                # Start containers
make down              # Stop containers
make restart           # Restart containers
make status            # Check container status
make logs              # View all logs
make logs-n8n          # View n8n logs
make logs-nginx        # View nginx logs
make logs-acme         # View certificate logs
make backup            # Backup n8n data
make restore           # Restore from backup
make firewall          # Configure UFW (22/80/443 only)
make fail2ban          # Install & configure fail2ban
make security-check    # Verify security
```

## Security Setup

### Firewall (UFW)

```bash
make firewall   # Configures UFW to allow only SSH (22), HTTP (80), HTTPS (443)
```

### Fail2ban - Brute Force Protection

```bash
make fail2ban   # Installs and configures fail2ban with n8n rules
```

This sets up protection for:
- SSH (3 failed attempts = 1 hour ban)
- Nginx auth (5 failed attempts = 10 min ban)
- n8n login (5 failed attempts = 30 min ban)

Check status:
```bash
sudo fail2ban-client status
sudo fail2ban-client status n8n-auth
```

## Troubleshooting

**Certificate not issued?**
```bash
make logs-acme
nslookup n8n.example.com
```

**n8n won't start?**
```bash
make logs-n8n
```

**Can't access n8n?**
```bash
make status
sudo ufw status
nslookup n8n.example.com
```

## Backup

```bash
make backup            # Creates: backups/YYYYMMDD_HHMMSS/n8n_data.tar.gz
make restore           # Interactive restore
```

Automate daily backups:
```bash
crontab -e
# Add: 0 2 * * * cd /path/to/n8n && make backup
```

## What's Included

- **n8n** (port 5678) - Workflow automation with SQLite database
- **Nginx** - Reverse proxy, HTTPS, security headers, basic auth
- **ACME Companion** - Let's Encrypt certificates with auto-renewal

All services on isolated Docker network with persistent volumes.

## Production Checklist

- [ ] Domain DNS points to server
- [ ] `.env` configured with custom values
- [ ] Strong password for `N8N_BASIC_AUTH_PASSWORD`
- [ ] Firewall configured (ports 22, 80, 443 only)
- [ ] Backup created: `make backup`
- [ ] HTTPS certificate issued: `make logs-acme`
- [ ] Access works: `https://n8n.example.com`

## System Requirements

- OS: Ubuntu 22.04+ or Debian 11+
- CPU: 1+ core
- RAM: 2GB minimum
- Disk: 10GB+
- Network: Fixed IP or dynamic DNS

## Support

- [n8n Docs](https://docs.n8n.io)
- [nginx-proxy](https://github.com/nginx-proxy/nginx-proxy)
- [Let's Encrypt](https://letsencrypt.org/)
